require 'test_helper'

class ForecastTest < ActiveSupport::TestCase
  test "should process payload correctly for input with correct format" do
    # Arrange
    location_api_payload_mock = '{"Headline":{"EffectiveDate":"2019-04-14T07:00:00-04:00","EffectiveEpochDate":1555239600,"Severity":4,"Text":"Agradable el domingo","Category":"","EndDate":null,"EndEpochDate":null,"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/extended-weather-forecast/60449?unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?unit=c"},"DailyForecasts":[{"Date":"2019-04-11T07:00:00-04:00","EpochDate":1554980400,"Sun":{"Rise":"2019-04-11T07:02:00-04:00","EpochRise":1554980520,"Set":"2019-04-11T18:25:00-04:00","EpochSet":1555021500},"Moon":{"Rise":"2019-04-11T12:59:00-04:00","EpochRise":1555001940,"Set":"2019-04-11T23:18:00-04:00","EpochSet":1555039080,"Phase":"WaxingCrescent","Age":6},"Temperature":{"Minimum":{"Value":9.4,"Unit":"C","UnitType":17},"Maximum":{"Value":26.7,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":12.2,"Unit":"C","UnitType":17},"Maximum":{"Value":27.8,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":12.2,"Unit":"C","UnitType":17},"Maximum":{"Value":25.6,"Unit":"C","UnitType":17}},"HoursOfSun":14,"DegreeDaySummary":{"Heating":{"Value":0,"Unit":"C","UnitType":17},"Cooling":{"Value":0,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Polución de partículas"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":1,"IconPhrase":"Soleado","ShortPhrase":"Mucho sol y agradable","LongPhrase":"Mucho sol y agradable","PrecipitationProbability":0,"ThunderstormProbability":0,"RainProbability":0,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":6.4,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":246,"Localized":"OSO","English":"WSW"}},"WindGust":{"Speed":{"Value":14.5,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":246,"Localized":"OSO","English":"WSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":2},"Night":{"Icon":34,"IconPhrase":"Mayormente despejado","ShortPhrase":"Principalmente claro","LongPhrase":"Principalmente claro","PrecipitationProbability":0,"ThunderstormProbability":0,"RainProbability":0,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":4.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":232,"Localized":"SO","English":"SW"}},"WindGust":{"Speed":{"Value":14.5,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":232,"Localized":"SO","English":"SW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":12},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=1&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=1&unit=c"},{"Date":"2019-04-12T07:00:00-04:00","EpochDate":1555066800,"Sun":{"Rise":"2019-04-12T07:03:00-04:00","EpochRise":1555066980,"Set":"2019-04-12T18:24:00-04:00","EpochSet":1555107840},"Moon":{"Rise":"2019-04-12T13:56:00-04:00","EpochRise":1555091760,"Set":"2019-04-13T00:19:00-04:00","EpochSet":1555129140,"Phase":"First","Age":7},"Temperature":{"Minimum":{"Value":8.9,"Unit":"C","UnitType":17},"Maximum":{"Value":25,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":10,"Unit":"C","UnitType":17},"Maximum":{"Value":25.6,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":10,"Unit":"C","UnitType":17},"Maximum":{"Value":23.3,"Unit":"C","UnitType":17}},"HoursOfSun":12.9,"DegreeDaySummary":{"Heating":{"Value":1,"Unit":"C","UnitType":17},"Cooling":{"Value":0,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Ozono"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":1,"IconPhrase":"Soleado","ShortPhrase":"Claro, con sol y agradable","LongPhrase":"Claro, con sol y agradable","PrecipitationProbability":1,"ThunderstormProbability":0,"RainProbability":1,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":6.4,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":259,"Localized":"O","English":"W"}},"WindGust":{"Speed":{"Value":14.5,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":259,"Localized":"O","English":"W"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":10},"Night":{"Icon":38,"IconPhrase":"Mayormente nublado","ShortPhrase":"Incremento de nubosidad","LongPhrase":"Incremento de nubosidad","PrecipitationProbability":2,"ThunderstormProbability":0,"RainProbability":2,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":4.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":258,"Localized":"OSO","English":"WSW"}},"WindGust":{"Speed":{"Value":12.9,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":258,"Localized":"OSO","English":"WSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":68},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=2&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=2&unit=c"},{"Date":"2019-04-13T07:00:00-04:00","EpochDate":1555153200,"Sun":{"Rise":"2019-04-13T07:03:00-04:00","EpochRise":1555153380,"Set":"2019-04-13T18:23:00-04:00","EpochSet":1555194180},"Moon":{"Rise":"2019-04-13T14:48:00-04:00","EpochRise":1555181280,"Set":"2019-04-14T01:25:00-04:00","EpochSet":1555219500,"Phase":"WaxingGibbous","Age":8},"Temperature":{"Minimum":{"Value":9.4,"Unit":"C","UnitType":17},"Maximum":{"Value":21.1,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":10.6,"Unit":"C","UnitType":17},"Maximum":{"Value":21.1,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":10.6,"Unit":"C","UnitType":17},"Maximum":{"Value":20,"Unit":"C","UnitType":17}},"HoursOfSun":2,"DegreeDaySummary":{"Heating":{"Value":3,"Unit":"C","UnitType":17},"Cooling":{"Value":0,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Ozono"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":1,"IconPhrase":"Soleado","ShortPhrase":"Nublado","LongPhrase":"Nublado","PrecipitationProbability":25,"ThunderstormProbability":5,"RainProbability":25,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":6.4,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":247,"Localized":"OSO","English":"WSW"}},"WindGust":{"Speed":{"Value":14.5,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":247,"Localized":"OSO","English":"WSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":92},"Night":{"Icon":35,"IconPhrase":"Parcialmente nublado","ShortPhrase":"Parcialmente nublado","LongPhrase":"Parcialmente nublado","PrecipitationProbability":7,"ThunderstormProbability":0,"RainProbability":7,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":4.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":216,"Localized":"SO","English":"SW"}},"WindGust":{"Speed":{"Value":11.3,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":216,"Localized":"SO","English":"SW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":40},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=3&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=3&unit=c"},{"Date":"2019-04-14T07:00:00-04:00","EpochDate":1555239600,"Sun":{"Rise":"2019-04-14T07:04:00-04:00","EpochRise":1555239840,"Set":"2019-04-14T18:21:00-04:00","EpochSet":1555280460},"Moon":{"Rise":"2019-04-14T15:36:00-04:00","EpochRise":1555270560,"Set":"2019-04-15T02:32:00-04:00","EpochSet":1555309920,"Phase":"WaxingGibbous","Age":9},"Temperature":{"Minimum":{"Value":9.4,"Unit":"C","UnitType":17},"Maximum":{"Value":24.8,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":12,"Unit":"C","UnitType":17},"Maximum":{"Value":25,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":12,"Unit":"C","UnitType":17},"Maximum":{"Value":23.5,"Unit":"C","UnitType":17}},"HoursOfSun":8.8,"DegreeDaySummary":{"Heating":{"Value":1,"Unit":"C","UnitType":17},"Cooling":{"Value":0,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Ozono"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":2,"IconPhrase":"Mayormente soleado","ShortPhrase":"Mucho sol; agradable","LongPhrase":"Mucho sol; agradable","PrecipitationProbability":3,"ThunderstormProbability":0,"RainProbability":3,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":5.6,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":223,"Localized":"SO","English":"SW"}},"WindGust":{"Speed":{"Value":14.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":216,"Localized":"SO","English":"SW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":25},"Night":{"Icon":34,"IconPhrase":"Mayormente despejado","ShortPhrase":"Claro a parcialmente nublado","LongPhrase":"Claro a parcialmente nublado","PrecipitationProbability":5,"ThunderstormProbability":0,"RainProbability":5,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":5.6,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":178,"Localized":"S","English":"S"}},"WindGust":{"Speed":{"Value":14.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":218,"Localized":"SO","English":"SW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":20},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=4&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=4&unit=c"},{"Date":"2019-04-15T07:00:00-04:00","EpochDate":1555326000,"Sun":{"Rise":"2019-04-15T07:05:00-04:00","EpochRise":1555326300,"Set":"2019-04-15T18:20:00-04:00","EpochSet":1555366800},"Moon":{"Rise":"2019-04-15T16:19:00-04:00","EpochRise":1555359540,"Set":"2019-04-16T03:42:00-04:00","EpochSet":1555400520,"Phase":"WaxingGibbous","Age":10},"Temperature":{"Minimum":{"Value":12.3,"Unit":"C","UnitType":17},"Maximum":{"Value":27.5,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":13.6,"Unit":"C","UnitType":17},"Maximum":{"Value":27.5,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":13.6,"Unit":"C","UnitType":17},"Maximum":{"Value":26.2,"Unit":"C","UnitType":17}},"HoursOfSun":11.3,"DegreeDaySummary":{"Heating":{"Value":0,"Unit":"C","UnitType":17},"Cooling":{"Value":2,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Ozono"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":1,"IconPhrase":"Soleado","ShortPhrase":"Sol y cielo azul profundo","LongPhrase":"Sol y cielo azul profundo","PrecipitationProbability":0,"ThunderstormProbability":0,"RainProbability":0,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":5.6,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":176,"Localized":"S","English":"S"}},"WindGust":{"Speed":{"Value":14.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":207,"Localized":"SSO","English":"SSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":0},"Night":{"Icon":33,"IconPhrase":"Despejado","ShortPhrase":"Claro","LongPhrase":"Claro","PrecipitationProbability":0,"ThunderstormProbability":0,"RainProbability":0,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":5.6,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":187,"Localized":"S","English":"S"}},"WindGust":{"Speed":{"Value":14.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":201,"Localized":"SSO","English":"SSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":0},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=5&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=5&unit=c"}]}'
    example_forecast_payload = JSON.parse(location_api_payload_mock)["DailyForecasts"]
    example_city = City.new({location_key: 1})
    example_city.save

    # Act
    CityForecastFactory.new().create_from_json(example_city, example_forecast_payload)

    # Assert
    assert true
  end

  test "should raise runtime error for input with incorrect format" do
    # Arrange
    location_api_payload_mock = '{"Headline":{"EffectiveDate":"2019-04-14T07:00:00-04:00","EffectiveEpochDate":1555239600,"Severity":4,"Text":"Agradable el domingo","Category":"","EndDate":null,"EndEpochDate":null,"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/extended-weather-forecast/60449?unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?unit=c"},"DailyForecasts":[{"Date":"2019-04-11T07:00:00-04:00","EpochDate":1554980400,"Sun":{"Rise":"2019-04-11T07:02:00-04:00","EpochRise":1554980520,"Set":"2019-04-11T18:25:00-04:00","EpochSet":1555021500},"Moon":{"Rise":"2019-04-11T12:59:00-04:00","EpochRise":1555001940,"Set":"2019-04-11T23:18:00-04:00","EpochSet":1555039080,"Phase":"WaxingCrescent","Age":6},"Temperature":{"Minimum":{"Value":9.4,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":26.7,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":12.2,"Unit":"C","UnitType":17},"Maxismum":{"Value":27.8,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":12.2,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":25.6,"Unit":"C","UnitType":17}},"HoursOfSun":14,"DegreeDaySummary":{"Heating":{"Value":0,"Unit":"C","UnitType":17},"Cooling":{"Value":0,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Polución de partículas"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":1,"IconPhrase":"Soleado","ShortPhrase":"Mucho sol y agradable","LongPhrase":"Mucho sol y agradable","PrecipitationProbability":0,"ThunderstormProbability":0,"RainProbability":0,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":6.4,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":246,"Localized":"OSO","English":"WSW"}},"WindGust":{"Speed":{"Value":14.5,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":246,"Localized":"OSO","English":"WSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":2},"Night":{"Icon":34,"IconPhrase":"Mayormente despejado","ShortPhrase":"Principalmente claro","LongPhrase":"Principalmente claro","PrecipitationProbability":0,"ThunderstormProbability":0,"RainProbability":0,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":4.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":232,"Localized":"SO","Englissh":"SW"}},"WindGust":{"Speed":{"Value":14.5,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":232,"Localized":"SO","English":"SW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":12},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=1&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=1&unit=c"},{"Date":"2019-04-12T07:00:00-04:00","EpochDate":1555066800,"Sun":{"Rise":"2019-04-12T07:03:00-04:00","EpochRise":1555066980,"Set":"2019-04-12T18:24:00-04:00","EpochSet":1555107840},"Moon":{"Rise":"2019-04-12T13:56:00-04:00","EpochRise":1555091760,"Set":"2019-04-13T00:19:00-04:00","EpochSet":1555129140,"Phase":"First","Age":7},"Temperature":{"Minimum":{"Value":8.9,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":25,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":10,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":25.6,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":10,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":23.3,"Unit":"C","UnitType":17}},"HoursOfSun":12.9,"DegreeDaySummary":{"Heating":{"Value":1,"Unit":"C","UnitType":17},"Cooling":{"Value":0,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Ozono"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":1,"IconPhrase":"Soleado","ShortPhrase":"Claro, con sol y agradable","LongPhrase":"Claro, con sol y agradable","PrecipitationProbability":1,"ThunderstormProbability":0,"RainProbability":1,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":6.4,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":259,"Localized":"O","English":"W"}},"WindGust":{"Speed":{"Value":14.5,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":259,"Localized":"O","English":"W"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":10},"Night":{"Icon":38,"IconPhrase":"Mayormente nublado","ShortPhrase":"Incremento de nubosidad","LongPhrase":"Incremento de nubosidad","PrecipitationProbability":2,"ThunderstormProbability":0,"RainProbability":2,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":4.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":258,"Localized":"OSO","English":"WSW"}},"WindGust":{"Speed":{"Value":12.9,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":258,"Localized":"OSO","English":"WSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":68},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=2&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=2&unit=c"},{"Date":"2019-04-13T07:00:00-04:00","EpochDate":1555153200,"Sun":{"Rise":"2019-04-13T07:03:00-04:00","EpochRise":1555153380,"Set":"2019-04-13T18:23:00-04:00","EpochSet":1555194180},"Moon":{"Rise":"2019-04-13T14:48:00-04:00","EpochRise":1555181280,"Set":"2019-04-14T01:25:00-04:00","EpochSet":1555219500,"Phase":"WaxingGibbous","Age":8},"Temperature":{"Minimum":{"Value":9.4,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":21.1,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":10.6,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":21.1,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":10.6,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":20,"Unit":"C","UnitType":17}},"HoursOfSun":2,"DegreeDaySummary":{"Heating":{"Value":3,"Unit":"C","UnitType":17},"Cooling":{"Value":0,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Ozono"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":1,"IconPhrase":"Soleado","ShortPhrase":"Nublado","LongPhrase":"Nublado","PrecipitationProbability":25,"ThunderstormProbability":5,"RainProbability":25,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":6.4,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":247,"Localized":"OSO","English":"WSW"}},"WindGust":{"Speed":{"Value":14.5,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":247,"Localized":"OSO","English":"WSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":92},"Night":{"Icon":35,"IconPhrase":"Parcialmente nublado","ShortPhrase":"Parcialmente nublado","LongPhrase":"Parcialmente nublado","PrecipitationProbability":7,"ThunderstormProbability":0,"RainProbability":7,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":4.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":216,"Localized":"SO","English":"SW"}},"WindGust":{"Speed":{"Value":11.3,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":216,"Localized":"SO","English":"SW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":40},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=3&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=3&unit=c"},{"Date":"2019-04-14T07:00:00-04:00","EpochDate":1555239600,"Sun":{"Rise":"2019-04-14T07:04:00-04:00","EpochRise":1555239840,"Set":"2019-04-14T18:21:00-04:00","EpochSet":1555280460},"Moon":{"Rise":"2019-04-14T15:36:00-04:00","EpochRise":1555270560,"Set":"2019-04-15T02:32:00-04:00","EpochSet":1555309920,"Phase":"WaxingGibbous","Age":9},"Temperature":{"Minimum":{"Value":9.4,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":24.8,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":12,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":25,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":12,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":23.5,"Unit":"C","UnitType":17}},"HoursOfSun":8.8,"DegreeDaySummary":{"Heating":{"Value":1,"Unit":"C","UnitType":17},"Cooling":{"Value":0,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Ozono"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":2,"IconPhrase":"Mayormente soleado","ShortPhrase":"Mucho sol; agradable","LongPhrase":"Mucho sol; agradable","PrecipitationProbability":3,"ThunderstormProbability":0,"RainProbability":3,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":5.6,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":223,"Localized":"SO","English":"SW"}},"WindGust":{"Speed":{"Value":14.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":216,"Localized":"SO","English":"SW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":25},"Night":{"Icon":34,"IconPhrase":"Mayormente despejado","ShortPhrase":"Claro a parcialmente nublado","LongPhrase":"Claro a parcialmente nublado","PrecipitationProbability":5,"ThunderstormProbability":0,"RainProbability":5,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":5.6,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":178,"Localized":"S","English":"S"}},"WindGust":{"Speed":{"Value":14.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":218,"Localized":"SO","English":"SW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":20},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=4&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=4&unit=c"},{"Date":"2019-04-15T07:00:00-04:00","EpochDate":1555326000,"Sun":{"Rise":"2019-04-15T07:05:00-04:00","EpochRise":1555326300,"Set":"2019-04-15T18:20:00-04:00","EpochSet":1555366800},"Moon":{"Rise":"2019-04-15T16:19:00-04:00","EpochRise":1555359540,"Set":"2019-04-16T03:42:00-04:00","EpochSet":1555400520,"Phase":"WaxingGibbous","Age":10},"Temperature":{"Minimum":{"Value":12.3,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":27.5,"Unit":"C","UnitType":17}},"RealFeelTemperature":{"Minimum":{"Value":13.6,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":27.5,"Unit":"C","UnitType":17}},"RealFeelTemperatureShade":{"Minimum":{"Value":13.6,"Unit":"C","UnitType":17},"Msaxsxom":{"Value":26.2,"Unit":"C","UnitType":17}},"HoursOfSun":11.3,"DegreeDaySummary":{"Heating":{"Value":0,"Unit":"C","UnitType":17},"Cooling":{"Value":2,"Unit":"C","UnitType":17}},"AirAndPollen":[{"Name":"AirQuality","Value":0,"Category":"Bien","CategoryValue":1,"Type":"Ozono"},{"Name":"Grass","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Mold","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Ragweed","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"Tree","Value":0,"Category":"Mín.","CategoryValue":1},{"Name":"UVIndex","Value":5,"Category":"Moderado","CategoryValue":2}],"Day":{"Icon":1,"IconPhrase":"Soleado","ShortPhrase":"Sol y cielo azul profundo","LongPhrase":"Sol y cielo azul profundo","PrecipitationProbability":0,"ThunderstormProbability":0,"RainProbability":0,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":5.6,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":176,"Localized":"S","English":"S"}},"WindGust":{"Speed":{"Value":14.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":207,"Localized":"SSO","English":"SSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":0},"Night":{"Icon":33,"IconPhrase":"Despejado","ShortPhrase":"Claro","LongPhrase":"Claro","PrecipitationProbability":0,"ThunderstormProbability":0,"RainProbability":0,"SnowProbability":0,"IceProbability":0,"Wind":{"Speed":{"Value":5.6,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":187,"Localized":"S","English":"S"}},"WindGust":{"Speed":{"Value":14.8,"Unit":"km/h","UnitType":7},"Direction":{"Degrees":201,"Localized":"SSO","English":"SSW"}},"TotalLiquid":{"Value":0,"Unit":"mm","UnitType":3},"Rain":{"Value":0,"Unit":"mm","UnitType":3},"Snow":{"Value":0,"Unit":"cm","UnitType":4},"Ice":{"Value":0,"Unit":"mm","UnitType":3},"HoursOfPrecipitation":0,"HoursOfRain":0,"HoursOfSnow":0,"HoursOfIce":0,"CloudCover":0},"Sources":["AccuWeather"],"MobileLink":"http://m.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=5&unit=c","Link":"http://www.accuweather.com/es/cl/santiago/60449/daily-weather-forecast/60449?day=5&unit=c"}]}'
    example_forecast_payload = JSON.parse(location_api_payload_mock)["DailyForecasts"]
    example_city = City.new({location_key: 1})
    example_city.save

    # Assert
    assert_raise(RuntimeError) {
      # Act
      CityForecastFactory.new().create_from_json(example_city, example_forecast_payload)
    }
  end
end
